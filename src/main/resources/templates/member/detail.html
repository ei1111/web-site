<!DOCTYPE html>
<html lang="ko" data-bs-theme="light" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>회원 정보 - ShopHub</title>

  <!-- fragments/common의 head 불러오기 -->
  <th:block th:replace="~{fragments/common :: head('회원 정보')}"></th:block>

  <!-- Bootstrap Icons (다크모드 토글용) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <style>
    :root {
      --primary-start: #2563eb;
      --primary-end: #0891b2;
      --card-bg: rgba(255, 255, 255, 0.82);
      --card-border: rgba(203, 213, 225, 0.3);
      --shadow-md: 0 12px 40px rgba(0,0,0,0.12);
    }

    [data-bs-theme="dark"] {
      --card-bg: rgba(30, 41, 59, 0.72);
      --card-border: rgba(59, 69, 92, 0.4);
    }

    body {
      background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
      min-height: 100vh;
      padding-top: 80px; /* navbar fixed-top 높이 고려 */
      color: #1e293b;
    }

    [data-bs-theme="dark"] body {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
    }

    .card-profile {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 20px;
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow-md);
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .card-profile:hover {
      transform: translateY(-12px) scale(1.015);
      box-shadow: 0 30px 70px rgba(0,0,0,0.18);
    }

    .card-header {
      background: linear-gradient(135deg, var(--primary-start) 0%, var(--primary-end) 100%);
      color: white;
      border-bottom: none;
      padding: 2.25rem 2rem;
      text-align: center;
    }

    .info-label {
      font-weight: 500;
      color: #64748b;
      font-size: 0.97rem;
      margin-bottom: 0.45rem;
    }

    .info-value {
      font-weight: 700;
      font-size: 1.2rem;
      color: #1e293b;
      word-break: break-word;
    }

    [data-bs-theme="dark"] .info-label {
      color: #94a3b8;
    }

    [data-bs-theme="dark"] .info-value {
      color: #e2e8f0;
    }

    .btn-update {
      background: linear-gradient(135deg, var(--primary-start) 0%, var(--primary-end) 100%);
      border: none;
      border-radius: 9999px;
      padding: 0.9rem 2.5rem;
      font-weight: 600;
      color: white !important;
      box-shadow: 0 10px 30px rgba(37,99,235,0.3);
      transition: all 0.3s ease;
    }

    .btn-update:hover {
      transform: translateY(-4px) scale(1.05);
      box-shadow: 0 18px 45px rgba(37,99,235,0.45);
      color: white !important;
    }

    .bd-mode-toggle .btn {
      background: linear-gradient(135deg, var(--primary-start) 0%, var(--primary-end) 100%);
      border: none;
      box-shadow: 0 8px 25px rgba(37,99,235,0.3);
      border-radius: 50%;
      width: 52px;
      height: 52px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @media (max-width: 576px) {
      .card-header {
        padding: 1.75rem 1.5rem;
      }
      .btn-update {
        width: 100%;
        padding: 0.9rem 1.5rem;
      }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .card-body {
      animation: fadeInUp 0.7s ease-out forwards;
    }
  </style>
</head>

<body>

<!-- 다크모드 토글 버튼 -->
<div class="dropdown position-fixed bottom-0 end-0 mb-5 me-4 bd-mode-toggle" style="z-index: 1030;">
  <button class="btn btn-primary shadow-lg" id="bd-theme" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Toggle theme">
    <i class="bi bi-circle-half fs-4"></i>
  </button>
  <ul class="dropdown-menu dropdown-menu-end shadow-lg" aria-labelledby="bd-theme" style="border-radius: 12px; min-width: 140px;">
    <li><button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="light"><i class="bi bi-sun-fill me-2"></i> Light</button></li>
    <li><button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark"><i class="bi bi-moon-stars-fill me-2"></i> Dark</button></li>
    <li><button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto"><i class="bi bi-circle-half me-2"></i> Auto</button></li>
  </ul>
</div>

<!-- Navbar (fragments/common에서 불러옴) -->
<header th:replace="~{fragments/common :: menu('detail')}"></header>

<main class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-xl-7">

      <div class="card card-profile">

        <div class="card-header">
          <h3 class="mb-0 fw-bold" th:text="#{member.detail.title}">회원 정보</h3>
        </div>

        <div class="card-body p-5">
          <div class="row g-4 text-center text-sm-start">

            <div class="col-sm-6">
              <div class="info-label" th:text="#{member.name}">이름</div>
              <div class="info-value" id="name">-</div>
            </div>

            <div class="col-sm-6">
              <div class="info-label" th:text="#{member.userId}">아이디</div>
              <div class="info-value" id="userId">-</div>
            </div>

            <div class="col-12">
              <div class="info-label" th:text="#{member.email}">이메일</div>
              <div class="info-value" id="email">-</div>
            </div>

            <div class="col-sm-6">
              <div class="info-label" th:text="#{member.city}">도시</div>
              <div class="info-value" id="city">-</div>
            </div>

            <div class="col-sm-6">
              <div class="info-label" th:text="#{member.street}">도로명</div>
              <div class="info-value" id="street">-</div>
            </div>

            <div class="col-12">
              <div class="info-label" th:text="#{member.zipcode}">우편번호</div>
              <div class="info-value" id="zipcode">-</div>
            </div>

          </div>

          <div class="mt-5 text-center text-sm-end">
            <button id="memberUpdate" class="btn btn-update btn-lg px-5" th:text="#{member.update.title}">
              회원 정보 수정
            </button>
          </div>
        </div>

      </div>

    </div>
  </div>
</main>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- 다크모드 토글 스크립트 -->
<script>
  (() => {
    'use strict'

    const getStoredTheme = () => localStorage.getItem('theme')
    const setStoredTheme = theme => localStorage.setItem('theme', theme)

    const getPreferredTheme = () => {
      const storedTheme = getStoredTheme()
      if (storedTheme) return storedTheme
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
    }

    const setTheme = theme => {
      if (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.setAttribute('data-bs-theme', 'dark')
      } else {
        document.documentElement.setAttribute('data-bs-theme', theme)
      }
    }

    const showActiveTheme = theme => {
      const themeSwitcher = document.querySelector('#bd-theme')
      if (!themeSwitcher) return

      const icon = themeSwitcher.querySelector('i')
      if (theme === 'light') {
        icon.className = 'bi bi-sun-fill fs-4'
      } else if (theme === 'dark') {
        icon.className = 'bi bi-moon-stars-fill fs-4'
      } else {
        icon.className = 'bi bi-circle-half fs-4'
      }
    }

    setTheme(getPreferredTheme())
    showActiveTheme(getPreferredTheme())

    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
      const storedTheme = getStoredTheme()
      if (storedTheme !== 'light' && storedTheme !== 'dark') {
        setTheme(getPreferredTheme())
        showActiveTheme(getPreferredTheme())
      }
    })

    document.querySelectorAll('[data-bs-theme-value]').forEach(toggle => {
      toggle.addEventListener('click', () => {
        const theme = toggle.getAttribute('data-bs-theme-value')
        setStoredTheme(theme)
        setTheme(theme)
        showActiveTheme(theme)
      })
    })
  })()
</script>

<!-- 회원 정보 불러오기 -->
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const token = localStorage.getItem("accessToken");
      if (!token) throw new Error("로그인이 필요합니다");

      const response = await fetch("/api/v1/members/me", {
        method: "GET",
        headers: { "Authorization": `Bearer ${token}` }
      });

      if (!response.ok) {
        throw new Error('회원 정보를 불러올 수 없습니다');
      }

      const member = await response.json();

      document.getElementById('name').textContent    = member.name    || '-';
      document.getElementById('userId').textContent  = member.userId  || '-';
      document.getElementById('email').textContent   = member.email   || '-';
      document.getElementById('city').textContent    = member.city    || '-';
      document.getElementById('street').textContent  = member.street  || '-';
      document.getElementById('zipcode').textContent = member.zipcode || '-';

    } catch (error) {
      console.error(error);
      alert("회원 정보를 불러오는 중 오류가 발생했습니다.");
    }
  });

  document.getElementById('memberUpdate')?.addEventListener('click', () => {
    window.location.href = "/view/update";
  });
</script>

<script th:src="@{/js/navbar.js}"></script>

</body>
</html>